<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AI-Based Effort Estimation</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h1>AI-Based Effort Estimation</h1>

<form id="effortForm" class="effort-form" method="post" action="/predict">

{% macro number_field(name, label, section) %}
<div class="form-row">
  <label>{{ label }}</label>
  <input type="number" name="{{ name }}" data-section="{{ section }}">
  <div class="error-text">This field is required</div>
</div>
{% endmacro %}

{% macro select_field(name, label, section, options) %}
<div class="form-row">
  <label>{{ label }}</label>
  <select name="{{ name }}" data-section="{{ section }}">
    <option value="">- Please select -</option>
    {% for o in options %}
    <option value="{{ o }}">{{ o }}</option>
    {% endfor %}
  </select>
  <div class="error-text">This field is required</div>
</div>
{% endmacro %}

<!-- ================= GROOMING ================= -->
<h2 class="section-heading">Grooming</h2>

{{ number_field("G_No_of_UserStories","No of User Stories","grooming") }}
{{ select_field("G_Story_Complexity","Story Complexity","grooming",[1,2,3]) }}
{{ select_field("G_Design_Complexity","Design Complexity","grooming",[1,2,3]) }}
{{ select_field("G_Meta_Complexity","Meta Complexity","grooming",[1,2,3]) }}
{{ number_field("G_Assumptions_Count","Assumptions Count","grooming") }}
{{ number_field("G_Features_Impacted","Features Impacted","grooming") }}
{{ select_field("G_Codebase_Study_Required","Codebase Study Required","grooming",[0,1]) }}
{{ number_field("G_No_of_Interfaces_Impacted","No of Interfaces Impacted","grooming") }}
{{ select_field("G_Interface_Complexity","Interface Complexity","grooming",[1,2,3]) }}
{{ select_field("G_Existing_Design_Study_Required","Existing Design Study Required","grooming",[0,1]) }}
{{ number_field("G_CrossComponent_Dependencies","Cross Component Dependencies","grooming") }}
{{ select_field("G_ICFS_Design_Complexity","ICFS Design Complexity","grooming",[1,2,3]) }}
{{ select_field("G_META_Impact_Level","META Impact Level","grooming",[1,2,3]) }}
{{ select_field("G_Cloud_Deployment","Cloud Deployment","grooming",[0,1]) }}
{{ select_field("G_Classical_Deployment","Classical Deployment","grooming",[0,1]) }}
{{ select_field("G_PM_impact","PM Impact","grooming",[0,1]) }}
{{ select_field("G_CM_impact","CM Impact","grooming",[0,1]) }}
{{ select_field("G_FM_impact","FM Impact","grooming",[0,1]) }}
{{ select_field("G_Fronthaul_impact","Fronthaul Impact","grooming",[0,1,2,3]) }}
{{ select_field("G_Backhaul_impact","Backhaul Impact","grooming",[0,1,2,3]) }}
{{ select_field("G_Tech_Lead_Support","Tech Lead Support","grooming",[0,1]) }}
{{ number_field("G_Open_Points_Percentage","Open Points Percentage","grooming") }}

<div class="section-action">
  <button type="submit" name="action" value="grooming" class="primary-btn">
    Calculate Grooming Effort
  </button>
  {% if grooming_effort is not none %}
  <div class="inline-result">
    Grooming Effort: <strong>{{ grooming_effort }} hrs</strong>
  </div>
  {% endif %}
</div>

<!-- ================= IMPLEMENTATION ================= -->
<h2 class="section-heading">Implementation</h2>

{{ number_field("I_No_of_UserStories","No of User Stories","implementation") }}
{{ select_field("I_Story_Complexity","Story Complexity","implementation",[1,2,3]) }}
{{ select_field("I_Design_Complexity","Design Complexity","implementation",[1,2,3]) }}
{{ select_field("I_Meta_Complexity","Meta Complexity","implementation",[1,2,3]) }}
{{ number_field("I_Features_Impacted","Features Impacted","implementation") }}
{{ number_field("I_Files_Impacted","Files Impacted","implementation") }}
{{ number_field("I_Approx_LOC_Source","Approx LOC Source","implementation") }}
{{ number_field("I_Approx_LOC_Test","Approx LOC Test","implementation") }}
{{ number_field("I_Approx_Code_Complexity","Approx Code Complexity","implementation") }}
{{ number_field("I_No_of_Interfaces_Impacted","No of Interfaces Impacted","implementation") }}
{{ select_field("I_Interface_Complexity","Interface Complexity","implementation",[1,2,3]) }}
{{ number_field("I_Interfaces_Added","Interfaces Added","implementation") }}
{{ number_field("I_Interfaces_Updated","Interfaces Updated","implementation") }}
{{ number_field("I_Interfaces_Deleted","Interfaces Deleted","implementation") }}
{{ select_field("I_Integration_Complexity","Integration Complexity","implementation",[1,2,3]) }}
{{ number_field("I_CrossComponent_Dependencies","Cross Component Dependencies","implementation") }}
{{ select_field("I_OAM_Simulator_Change","OAM Simulator Change","implementation",[0,1]) }}
{{ number_field("I_UT_Count","UT Count","implementation") }}
{{ number_field("I_PYSCT_Count","PYSCT Count","implementation") }}
{{ number_field("I_New_Test_Cases","New Test Cases","implementation") }}
{{ select_field("I_Test_Case_Complexity","Test Case Complexity","implementation",[1,2,3]) }}
{{ number_field("I_Test_Coverage","Test Coverage","implementation") }}
{{ number_field("I_Legacy_Test_Coverage","Legacy Test Coverage","implementation") }}
{{ select_field("I_ICFS_Design_Complexity","ICFS Design Complexity","implementation",[1,2,3]) }}
{{ select_field("I_PM_impact","PM Impact","implementation",[0,1]) }}
{{ select_field("I_CM_impact","CM Impact","implementation",[0,1]) }}
{{ select_field("I_FM_impact","FM Impact","implementation",[0,1]) }}
{{ select_field("I_Tech_Lead_Support","Tech Lead Support","implementation",[0,1]) }}

<div class="section-action">
  <button type="submit" name="action" value="implementation" class="primary-btn">
    Calculate Implementation Effort
  </button>
  {% if implementation_effort is not none %}
  <div class="inline-result">
    Implementation Effort: <strong>{{ implementation_effort }} hrs</strong>
  </div>
  {% endif %}
</div>

<div class="final-action">
  <button type="submit" name="action" value="final" class="primary-btn final-btn">
    Calculate Final Effort
  </button>
</div>

{% if final_effort is not none %}
<div class="final-result">
  Final Effort: <strong>{{ final_effort }} hrs</strong>
</div>
{% endif %}

</form>

<script>
function validate(section) {
  let valid = true;
  let firstInvalid = null;

  document.querySelectorAll(`[data-section="${section}"]`).forEach(el => {
    const error = el.nextElementSibling;
    if (el.value === "") {
      el.classList.add("invalid");
      error.style.display = "block";
      if (!firstInvalid) firstInvalid = el;
      valid = false;
    } else {
      el.classList.remove("invalid");
      error.style.display = "none";
    }
  });

  if (firstInvalid) {
    firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
    firstInvalid.focus();
  }
  return valid;
}

document.querySelectorAll("button[type='submit']").forEach(btn => {
  btn.addEventListener("click", e => {
    const action = btn.value;
    let ok = true;

    if (action === "grooming") ok = validate("grooming");
    if (action === "implementation") ok = validate("implementation");
    if (action === "final")
      ok = validate("grooming") & validate("implementation");

    if (!ok) e.preventDefault();
  });
});
</script>

</body>
</html>
